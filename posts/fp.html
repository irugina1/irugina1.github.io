---
layout: post
---
<style>
    .center {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 50%;
    }
    </style>
    
    

<h1> Mixed Precision</h1>

<h3>Floating Point Format</h3>

<h4>Float32</h4>


<svg width="600" height="100">
    <!-- Sign bit -->
    <rect x="10" y="20" width="50" height="50" style="fill:lightblue;stroke:black;stroke-width:1" />
    <text x="35" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Sign</text>
    <line x1="10" y1="70" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <text x="35" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">1 bit</text>
    
    <!-- Exponent bits -->
    <rect x="70" y="20" width="150" height="50" style="fill:lightgreen;stroke:black;stroke-width:1" />
    <text x="145" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Exponent</text>
    <line x1="70" y1="70" x2="220" y2="70" style="stroke:black;stroke-width:1" />
    <text x="145" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">8 bits</text>
    
    <!-- Mantissa bits -->
    <rect x="230" y="20" width="350" height="50" style="fill:lightcoral;stroke:black;stroke-width:1" />
    <text x="405" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Mantissa</text>
    <line x1="230" y1="70" x2="580" y2="70" style="stroke:black;stroke-width:1" />
    <text x="405" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">23 bits</text>
    
    <!-- Vertical lines for each bit -->
    <line x1="10" y1="20" x2="10" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="60" y1="20" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="70" y1="20" x2="70" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="220" y1="20" x2="220" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="230" y1="20" x2="230" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="580" y1="20" x2="580" y2="70" style="stroke:black;stroke-width:1" />
</svg>

<pre><code>
import numpy as np

def show_precision_gap(value):
    """Show the gap between a value and the next representable float32 number"""
    f32_value = np.float32(value)
    next_value = np.nextafter(f32_value, np.float32(value + 1))
    gap = next_value - f32_value
    return gap

show_precision_gap(1)
1.1920929e-07 ~= 2**(-23)

show_precision_gap(1024)
0.00012207031 ~= 2**(-13)



</code></pre>

<h4>Float16</h4>



<svg width="400" height="100">
    <!-- Sign bit -->
    <rect x="10" y="20" width="50" height="50" style="fill:lightblue;stroke:black;stroke-width:1" />
    <text x="35" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Sign</text>
    <line x1="10" y1="70" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <text x="35" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">1 bit</text>
    
    <!-- Exponent bits -->
    <rect x="70" y="20" width="100" height="50" style="fill:lightgreen;stroke:black;stroke-width:1" />
    <text x="120" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Exponent</text>
    <line x1="70" y1="70" x2="170" y2="70" style="stroke:black;stroke-width:1" />
    <text x="120" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">5 bits</text>
    
    <!-- Mantissa bits -->
    <rect x="180" y="20" width="200" height="50" style="fill:lightcoral;stroke:black;stroke-width:1" />
    <text x="280" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Mantissa</text>
    <line x1="180" y1="70" x2="380" y2="70" style="stroke:black;stroke-width:1" />
    <text x="280" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">10 bits</text>
    
    <!-- Vertical lines for each bit -->
    <line x1="10" y1="20" x2="10" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="60" y1="20" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="70" y1="20" x2="70" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="170" y1="20" x2="170" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="180" y1="20" x2="180" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="380" y1="20" x2="380" y2="70" style="stroke:black;stroke-width:1" />
</svg>

<h4>bfloat16</h4>

<svg width="400" height="100">
    <!-- Sign bit -->
    <rect x="10" y="20" width="50" height="50" style="fill:lightblue;stroke:black;stroke-width:1" />
    <text x="35" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Sign</text>
    <line x1="10" y1="70" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <text x="35" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">1 bit</text>
    
    <!-- Exponent bits -->
    <rect x="70" y="20" width="150" height="50" style="fill:lightgreen;stroke:black;stroke-width:1" />
    <text x="145" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Exponent</text>
    <line x1="70" y1="70" x2="220" y2="70" style="stroke:black;stroke-width:1" />
    <text x="145" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">8 bits</text>
    
    <!-- Mantissa bits -->
    <rect x="230" y="20" width="150" height="50" style="fill:lightcoral;stroke:black;stroke-width:1" />
    <text x="310" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Mantissa</text>
    <line x1="230" y1="70" x2="380" y2="70" style="stroke:black;stroke-width:1" />
    <text x="310" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">7 bits</text>
    
    <!-- Vertical lines for each bit -->
    <line x1="10" y1="20" x2="10" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="60" y1="20" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="70" y1="20" x2="70" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="220" y1="20" x2="220" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="230" y1="20" x2="230" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="380" y1="20" x2="380" y2="70" style="stroke:black;stroke-width:1" />
</svg>

<h4>TensorFloat-32 (TF32)</h4>

<svg width="600" height="100">
    <!-- Sign bit -->
    <rect x="10" y="20" width="50" height="50" style="fill:lightblue;stroke:black;stroke-width:1" />
    <text x="35" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Sign</text>
    <line x1="10" y1="70" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <text x="35" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">1 bit</text>
    
    <!-- Exponent bits -->
    <rect x="70" y="20" width="150" height="50" style="fill:lightgreen;stroke:black;stroke-width:1" />
    <text x="145" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Exponent</text>
    <line x1="70" y1="70" x2="220" y2="70" style="stroke:black;stroke-width:1" />
    <text x="145" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">8 bits</text>
    
    <!-- Mantissa bits -->
    <rect x="230" y="20" width="200" height="50" style="fill:lightcoral;stroke:black;stroke-width:1" />
    <text x="335" y="55" font-family="Verdana" font-size="20" fill="black" text-anchor="middle">Mantissa</text>
    <line x1="230" y1="70" x2="430" y2="70" style="stroke:black;stroke-width:1" />
    <text x="335" y="85" font-family="Verdana" font-size="12" fill="black" text-anchor="middle">10 bits</text>
    
    <!-- Vertical lines for each bit -->
    <line x1="10" y1="20" x2="10" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="60" y1="20" x2="60" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="70" y1="20" x2="70" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="220" y1="20" x2="220" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="230" y1="20" x2="230" y2="70" style="stroke:black;stroke-width:1" />
    <line x1="430" y1="20" x2="430" y2="70" style="stroke:black;stroke-width:1" />
</svg>